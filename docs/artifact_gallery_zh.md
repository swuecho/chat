# 制品画廊

## 概述

制品画廊是一个综合管理界面，用于查看、组织和与聊天对话中生成的代码制品进行交互。它提供了一个集中的位置来浏览、执行和管理不同聊天会话中创建的所有制品。

## 功能特性

### 1. **制品管理**
- **浏览制品** 在一个地方查看所有聊天会话的制品
- **过滤和搜索** 按类型、语言、会话或内容进行筛选
- **排序制品** 按创建日期、类型、执行次数或评分排序
- **查看统计** 关于制品使用和性能的统计信息
- **导出制品** 以JSON格式导出以供备份或分享

### 2. **代码执行**
- **运行JavaScript/Python代码** 直接在画廊中执行
- **实时输出** 带语法高亮的输出
- **错误处理** 详细的错误消息
- **性能指标** 包括执行时间
- **库支持** 支持流行的包（lodash, d3, numpy, pandas等）

### 3. **制品查看**
- **HTML渲染** 在安全的iframe沙盒中
- **SVG可视化** 带正确缩放
- **JSON格式化** 带验证功能
- **Mermaid图表** 渲染
- **语法高亮** 用于代码制品

### 4. **组织工具**
- **网格和列表视图** 不同的浏览偏好
- **分页** 用于大型制品集合
- **基于标签的分类** 自动标签生成
- **会话上下文** 显示哪个聊天创建了每个制品
- **重复检测** 和管理

## 访问画廊

### 从聊天界面
1. 点击聊天页脚的**画廊**按钮（画廊图标）
2. 画廊将在聊天界面的位置打开
3. 使用相同的画廊按钮返回聊天视图

### 导航
- **在聊天和画廊之间切换** 使用画廊按钮
- **在网格和列表视图之间切换** 使用视图切换
- **使用过滤器** 按特定条件缩小制品范围

## 制品类型

### 可执行制品
这些制品可以直接在画廊中运行：

#### JavaScript/TypeScript
- **支持的功能**：ES6+、async/await、类、模块
- **可用库**：lodash、d3、chart.js、moment、axios、rxjs、p5、three、fabric
- **Canvas支持**：创建交互式图形和可视化
- **执行环境**：安全的Web Worker沙盒

#### Python
- **支持的功能**：Python 3.x语法、科学计算
- **可用包**：numpy、pandas、matplotlib、scipy、scikit-learn、requests、beautifulsoup4、pillow、sympy、networkx、seaborn、plotly、bokeh、altair
- **绘图支持**：Matplotlib图表渲染为图像
- **执行环境**：基于Pyodide的Python解释器

### 可查看制品
这些制品用于视觉检查：

#### HTML
- **安全渲染**：带限制权限的iframe沙盒
- **完整HTML支持**：CSS、基本JavaScript、表单、模态框
- **响应式设计**：适应不同屏幕尺寸
- **外部链接**：在新窗口中打开的能力

#### SVG
- **矢量图形**：可缩放和清晰的渲染
- **交互元素**：悬停效果和基本交互
- **主题适应**：为深色/浅色主题调整颜色
- **导出能力**：下载为SVG文件

#### JSON
- **格式化显示**：带语法高亮的美化打印
- **验证**：自动JSON语法验证
- **复制功能**：轻松复制格式化的JSON
- **大文件支持**：高效处理大型JSON结构

#### Mermaid
- **图表类型**：流程图、序列图、类图等
- **自动渲染**：自动转换为视觉图表
- **响应式**：适应容器大小
- **主题支持**：遵循应用主题

## 界面元素

### 画廊标题
- **标题和计数**：显示制品总数
- **操作按钮**：访问过滤器、统计和导出
- **搜索栏**：跨所有制品的快速文本搜索

### 过滤器面板
- **搜索**：跨标题、内容和标签的文本搜索
- **类型过滤**：按制品类型过滤（代码、HTML、SVG等）
- **语言过滤**：按编程语言过滤
- **会话过滤**：按聊天会话过滤
- **日期范围**：按创建日期过滤
- **排序选项**：多个排序条件

### 统计面板
- **总制品**：制品总数
- **执行统计**：总运行次数、平均执行时间、成功率
- **类型分布**：制品类型的分布
- **语言分布**：流行的编程语言
- **性能图表**：使用模式的视觉表示

### 制品卡片（网格视图）
- **制品预览**：截断的代码或内容预览
- **元数据**：创建日期、语言、会话信息
- **操作按钮**：预览、运行/查看、编辑、复制、删除
- **标签**：自动生成和自定义标签
- **执行计数**：制品被运行的次数

### 制品行（列表视图）
- **紧凑布局**：一次显示更多制品
- **基本信息**：标题、类型、语言、创建日期
- **快速操作**：所有管理功能都可访问
- **会话上下文**：源聊天会话的清楚指示

## 操作和功能

### 运行代码制品
1. **点击运行按钮**（播放图标）在JavaScript/Python制品上
2. **运行模态框打开** 带代码预览和执行控件
3. **执行代码** 使用"运行代码"按钮
4. **查看输出** 实时显示带语法高亮的输出
5. **清除结果** 在新环境中重新运行

### 查看视觉制品
1. **点击查看按钮**（外部链接图标）在HTML/SVG/JSON制品上
2. **查看模态框打开** 带正确渲染
3. **与内容交互**（对于HTML制品）
4. **复制内容** 使用复制按钮
5. **关闭模态框** 返回画廊

### 管理制品
- **预览**：快速查看制品内容
- **编辑**：修改制品内容并保存更改
- **复制**：创建副本用于实验
- **删除**：永久删除制品（带确认）
- **复制**：将制品内容复制到剪贴板
- **下载**：将制品保存为带正确扩展名的文件

## 高级功能

### 自动标签
画廊基于以下内容自动生成标签：
- **编程语言**（javascript、python、html等）
- **框架使用**（react、vue、pandas、matplotlib等）
- **代码模式**（async、functions、classes、loops等）
- **库**（lodash、d3、numpy等）
- **执行结果**（error、success、slow、fast等）

### 会话上下文
每个制品维护与其源的连接：
- **会话标题**：聊天会话的名称
- **消息上下文**：哪个消息创建了制品
- **时间戳**：制品创建的时间
- **编辑跟踪**：制品是否已被修改

### 性能跟踪
- **执行时间**：代码运行所需的时间
- **成功率**：成功执行的百分比
- **错误模式**：常见错误类型和频率
- **使用统计**：最常运行的制品

### 导出和备份
- **JSON导出**：带元数据的完整制品数据
- **过滤导出**：仅导出选定或过滤的制品
- **备份格式**：结构化以便于导入/恢复
- **分享**：与他人分享制品集合

## 最佳实践

### 组织
- **使用描述性标题** 创建制品时
- **添加自定义标签** 更好的组织
- **定期清理** 过时或实验性制品
- **会话命名** 提供更好的上下文

### 代码执行
- **增量测试** 开发复杂代码时
- **使用console.log** 调试JavaScript
- **优雅处理错误** 在您的代码中
- **注意执行时间** 对于复杂操作

### 性能
- **使用分页** 用于大型制品集合
- **清除执行结果** 当不需要时
- **过滤制品** 专注于相关项目
- **定期导出** 用于备份和存档

## 安全考虑

### 代码执行
- **沙盒环境**：所有代码在隔离的Web Worker中运行
- **无网络访问**：直接网络请求被阻止
- **无文件系统访问**：无法读写本地文件
- **有限DOM访问**：无法修改父应用程序
- **超时保护**：长时间运行的代码自动终止

### 内容渲染
- **HTML沙盒**：iframe沙盒防止恶意脚本
- **SVG清理**：删除潜在危险元素
- **内容验证**：JSON和其他格式被验证
- **安全来源**：外部资源受限

## 故障排除

### 常见问题
- **代码不运行**：检查语言支持和语法
- **制品不加载**：刷新页面或检查浏览器控制台
- **性能问题**：减少制品数量或使用过滤器
- **导出失败**：检查浏览器下载权限

### 浏览器兼容性
- **现代浏览器**：Chrome、Firefox、Safari、Edge（最新版本）
- **需要JavaScript**：画廊需要JavaScript才能运行
- **本地存储**：用于偏好设置和临时数据
- **WebWorkers**：代码执行功能所需

## API集成

画廊与聊天应用程序的API集成：

```javascript
// 示例：从特定会话获取制品
const artifacts = await fetch(`/api/chat/sessions/${sessionId}/artifacts`);

// 示例：执行代码制品
const result = await fetch(`/api/artifacts/${artifactId}/execute`, {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': `Bearer ${token}`
  },
  body: JSON.stringify({
    code: artifactContent,
    language: 'javascript'
  })
});
```

## 未来增强

### 计划功能
- **制品版本控制**：跟踪更改并维护历史记录
- **协作编辑**：多用户编辑制品
- **高级分析**：详细的使用和性能指标
- **模板系统**：创建可重用的制品模板
- **AI建议**：自动代码改进和建议

### 社区功能
- **制品分享**：用于分享有用制品的公共画廊
- **评分系统**：社区对流行制品的评分
- **评论**：制品的协作讨论
- **集合**：相关制品的策划集合

此文档提供了有效使用制品画廊的全面指南。有关技术实现细节，请参阅`/src/views/chat/components/ArtifactGallery.vue`中的源代码。